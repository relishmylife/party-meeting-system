# 党组织生活会议管理系统 - 启动脚本使用指南

## 📋 文档信息

- **文档名称**: 启动脚本使用指南
- **项目**: 内蒙古科技大学党组织生活会议管理系统
- **版本**: v1.0
- **作者**: MiniMax Agent
- **日期**: 2025-12-01

## 🎯 概述

为了方便部署和管理，我们创建了完整的启动脚本套件，支持一键启动所有服务、生产环境部署、开发环境启动以及服务停止等操作。这些脚本经过精心设计，具有错误处理、日志记录、健康检查等企业级功能。

## 🛠️ 脚本清单

### 1. start-all-services.sh - 一键启动所有服务

**文件路径**: `/workspace/party-meeting-system/start-all-services.sh`
**功能**: 完整的系统启动脚本，支持生产模式和开发模式
**权限要求**: sudo

#### 主要特性
- ✅ **自动化程度高**: 一键启动，无需手动配置
- ✅ **多模式支持**: 生产模式和开发模式
- ✅ **依赖检查**: 自动检查Node.js、Nginx等依赖
- ✅ **健康检查**: 启动后自动验证服务状态
- ✅ **错误处理**: 完善的错误处理和回滚机制
- ✅ **日志记录**: 详细的操作日志和状态记录
- ✅ **安全检查**: 自动检查权限、端口、配置等

#### 使用方法

**基本用法:**
```bash
# 进入项目目录
cd /workspace/party-meeting-system

# 生产模式启动 (推荐)
sudo bash start-all-services.sh

# 开发模式启动
sudo bash start-all-services.sh dev

# 查看帮助
sudo bash start-all-services.sh --help
```

**生产模式启动流程:**
1. 权限检查和依赖验证
2. 环境准备和端口检查
3. Supabase后端连接验证
4. 项目依赖安装
5. 生产版本构建
6. Nginx配置和部署
7. 静态文件部署
8. 服务启动和健康检查

**开发模式启动流程:**
1. 权限检查和依赖验证
2. 环境准备和端口检查
3. Supabase后端连接验证
4. 项目依赖安装
5. Vite开发服务器启动
6. 热重载功能启用

#### 配置文件说明

**Nginx配置路径**: `/etc/nginx/sites-available/party-system`
**静态文件路径**: `/var/www/party-system/`
**日志目录**: `/var/log/party-system/`
**PID目录**: `/var/run/party-system/`

### 2. stop-all-services.sh - 停止所有服务

**文件路径**: `/workspace/party-meeting-system/stop-all-services.sh`
**功能**: 安全停止所有相关服务
**权限要求**: sudo

#### 主要特性
- ✅ **多种停止模式**: 快速、强制、完整
- ✅ **进程清理**: 彻底清理所有相关进程
- ✅ **端口释放**: 清理端口占用
- ✅ **临时文件清理**: 自动清理临时文件和缓存
- ✅ **关闭报告**: 生成详细的关闭报告

#### 使用方法

**完整停止 (默认):**
```bash
sudo bash stop-all-services.sh
```

**快速停止:**
```bash
sudo bash stop-all-services.sh --quick
```

**强制停止:**
```bash
sudo bash stop-all-services.sh --force
```

**查看状态:**
```bash
sudo bash stop-all-services.sh --status
```

**查看帮助:**
```bash
sudo bash stop-all-services.sh --help
```

#### 停止模式说明

| 模式 | 参数 | 描述 | 适用场景 |
|------|------|------|----------|
| 完整停止 | `--full` | 停止所有服务，清理文件，生成报告 | 日常维护 |
| 快速停止 | `--quick` | 仅停止主要服务 | 紧急情况 |
| 强制停止 | `--force` | 强制终止所有相关进程 | 服务无响应 |
| 状态查看 | `--status` | 显示当前服务状态 | 状态检查 |

### 3. quick-dev-start.sh - 快速开发启动

**文件路径**: `/workspace/party-meeting-system/quick-dev-start.sh`
**功能**: 专门用于开发环境的快速启动脚本
**权限要求**: 无需sudo

#### 主要特性
- ✅ **开发优化**: 专门针对开发环境优化
- ✅ **快速启动**: 最简化的启动流程
- ✅ **智能依赖**: 自动检查和安装依赖
- ✅ **端口管理**: 智能处理端口冲突
- ✅ **热重载**: 启用Vite热重载功能
- ✅ **实时日志**: 显示实时开发日志

#### 使用方法

**基本用法:**
```bash
# 开发模式启动
./quick-dev-start.sh

# 查看帮助
./quick-dev-start.sh --help
```

**开发启动流程:**
1. 项目目录检查
2. Node.js环境验证
3. 端口可用性检查
4. 依赖自动安装
5. Vite开发服务器启动
6. 实时状态监控

#### 开发环境特点

- **端口**: 5173 (Vite默认)
- **特点**: 热重载、快速构建、调试友好
- **适用**: 开发测试、本地演示
- **限制**: 仅适用于开发环境

### 4. 服务启动顺序指南.md

**文件路径**: `/workspace/party-meeting-system/服务启动顺序指南.md`
**功能**: 详细的系统启动顺序说明文档

#### 文档内容
- 📋 系统架构概览和依赖关系
- 🔄 不同启动模式的详细说明
- 📋 分步骤的启动顺序指导
- ⚠️ 常见问题与解决方案
- 🔍 服务监控与维护指南
- 📊 性能指标和资源要求

## 🚀 快速使用指南

### 开发环境启动

**步骤1: 快速启动开发服务器**
```bash
cd /workspace/party-meeting-system
./quick-dev-start.sh
```

**步骤2: 访问应用**
- 本地访问: http://localhost:5173
- 网络访问: http://[服务器IP]:5173

**步骤3: 停止开发服务器**
```bash
# 方法1: 按 Ctrl+C
# 方法2: 终止进程
kill $(cat /tmp/dev-server.pid)
# 方法3: 使用停止脚本
sudo bash stop-all-services.sh --quick
```

### 生产环境部署

**步骤1: 完整系统启动**
```bash
cd /workspace/party-meeting-system
sudo bash start-all-services.sh
```

**步骤2: 验证服务状态**
```bash
# 检查Nginx状态
sudo systemctl status nginx

# 测试Web访问
curl http://localhost

# 查看详细状态
sudo bash stop-all-services.sh --status
```

**步骤3: 生产环境访问**
- HTTP访问: http://localhost/
- HTTPS访问: https://party.imust.edu.cn/ (需SSL证书)

### 系统维护

**日常检查**
```bash
# 查看服务状态
sudo bash stop-all-services.sh --status

# 查看日志
sudo tail -f /var/log/party-system/startup.log

# 重启服务
sudo systemctl restart nginx
```

**系统清理**
```bash
# 完整停止并清理
sudo bash stop-all-services.sh --full

# 清理临时文件
sudo bash stop-all-services.sh --full --restart-network
```

## 📊 服务状态监控

### 启动后检查清单

- [ ] Nginx服务运行正常
- [ ] Web页面可以正常访问
- [ ] API代理工作正常 (检查Supabase连接)
- [ ] 没有错误日志
- [ ] 静态资源可以访问
- [ ] 端口配置正确

### 关键监控指标

| 组件 | 检查命令 | 预期状态 |
|------|----------|----------|
| Nginx | `systemctl status nginx` | active (running) |
| Web访问 | `curl -I http://localhost` | HTTP/1.1 200 OK |
| 开发服务器 | `netstat -tlnp \| grep :5173` | LISTEN状态 |
| 端口80 | `netstat -tlnp \| grep :80` | LISTEN状态 |
| 磁盘空间 | `df -h /var/www` | 可用空间 > 1GB |

### 日志位置

- **系统启动日志**: `/var/log/party-system/startup.log`
- **Nginx访问日志**: `/var/log/nginx/party-system.access.log`
- **Nginx错误日志**: `/var/log/nginx/party-system.error.log`
- **关闭报告**: `/var/log/party-system/shutdown-report-*.txt`
- **开发日志**: `/tmp/dev-startup.log`

## ⚠️ 注意事项

### 权限要求
- **启动脚本**: 需要sudo权限
- **开发脚本**: 无需sudo权限
- **停止脚本**: 需要sudo权限

### 端口配置
- **开发端口**: 5173 (Vite)
- **HTTP端口**: 80
- **HTTPS端口**: 443
- **注意**: 确保端口未被其他服务占用

### 环境要求
- **操作系统**: Linux (Ubuntu 20.04+ / CentOS 7+)
- **Node.js**: >= 16.0.0
- **Nginx**: >= 1.18
- **内存**: 最低1GB，推荐2GB+
- **磁盘**: 最低5GB可用空间

### 网络配置
- **Supabase**: 需要访问 https://lfmpvxczahvcselayyho.supabase.co
- **防火墙**: 需要开放80、443、22端口
- **DNS**: 域名解析需要正确配置

## 🔧 故障排除

### 常见问题

**问题1: 权限错误**
```
错误: Operation not permitted
解决: 使用sudo运行启动脚本
```

**问题2: 端口被占用**
```
错误: Address already in use
解决: 使用脚本的自动清理功能或手动终止占用进程
```

**问题3: 依赖安装失败**
```
错误: npm/pnpm install 失败
解决: 检查网络连接，清理缓存，重新安装
```

**问题4: Nginx配置错误**
```
错误: nginx configuration test failed
解决: 检查配置文件语法，查看错误日志
```

**问题5: Supabase连接失败**
```
错误: Supabase service unavailable
解决: 检查网络连接和防火墙设置
```

### 恢复操作

**完全重置系统:**
```bash
# 1. 停止所有服务
sudo bash stop-all-services.sh --force

# 2. 清理文件和缓存
sudo rm -rf /var/www/party-system
sudo rm -rf /var/log/party-system
sudo rm -rf /var/run/party-system

# 3. 重新启动
sudo bash start-all-services.sh
```

## 📞 技术支持

### 获取帮助
1. **查看脚本帮助**: 使用 `--help` 参数
2. **查看详细文档**: 阅读 `服务启动顺序指南.md`
3. **检查日志文件**: 查看相关日志文件
4. **使用状态检查**: 运行状态检查命令

### 联系信息
- **项目名称**: 内蒙古科技大学党组织生活会议管理系统
- **技术支持**: MiniMax Agent
- **版本**: v1.0
- **最后更新**: 2025-12-01

---

**重要提醒**: 
1. 首次使用请仔细阅读 `服务启动顺序指南.md`
2. 生产环境部署前请先在测试环境验证
3. 定期备份重要数据和配置文件
4. 监控系统资源使用情况