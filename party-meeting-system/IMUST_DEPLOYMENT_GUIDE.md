# å†…è’™å¤ç§‘æŠ€å¤§å­¦å…šç»„ç»‡ç”Ÿæ´»ä¼šè®®ç®¡ç†ç³»ç»Ÿ
## è¯¦ç»†éƒ¨ç½²å®æ–½æŒ‡å—

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**éƒ¨ç½²ç›®æ ‡**: `party.imust.edu.cn`  
**éƒ¨ç½²æ–¹å¼**: å­¦æ ¡å­åŸŸå + äº‘æœåŠ¡å™¨  
**é¢„ä¼°æ—¶é—´**: 2-3ä¸ªå·¥ä½œæ—¥  

---

## ğŸ¯ éƒ¨ç½²ç›®æ ‡ä¸é¢„æœŸ

### éƒ¨ç½²æˆåŠŸæ ‡å‡†
- âœ… ç³»ç»Ÿå¯åœ¨ `party.imust.edu.cn` æ­£å¸¸è®¿é—®
- âœ… ä¸å­¦æ ¡CASè®¤è¯ç³»ç»Ÿæ— ç¼å¯¹æ¥
- âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… æ”¯æŒ500+å¹¶å‘ç”¨æˆ·è®¿é—®
- âœ… ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯å‡å¯æ­£å¸¸ä½¿ç”¨
- âœ… ç³»ç»Ÿå®‰å…¨ç¨³å®šè¿è¡Œ

### é¢„æœŸæ•ˆæœ
- **æå‡ç®¡ç†æ•ˆç‡**: å…šç»„ç»‡ç”Ÿæ´»ç®¡ç†æ•°å­—åŒ–
- **è§„èŒƒå·¥ä½œæµç¨‹**: æ ‡å‡†åŒ–çš„ä¼šè®®ç®¡ç†æµç¨‹
- **å¢å¼ºæ•°æ®ç»Ÿè®¡**: å®æ—¶ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½
- **æ”¹å–„ç”¨æˆ·ä½“éªŒ**: ç°ä»£åŒ–ç•Œé¢è®¾è®¡

---

## ğŸ“‹ ç¬¬ä¸€é˜¶æ®µ: å‰æœŸå‡†å¤‡ (1-2å¤©)

### 1.1 èµ„æºç”³è¯·æ¸…å•

#### å‘å­¦æ ¡ç”³è¯·çš„èµ„æº
| èµ„æºç±»å‹ | ç”³è¯·éƒ¨é—¨ | æ‰€éœ€æ—¶é—´ | å¤‡æ³¨ |
|---------|---------|---------|------|
| å­åŸŸå `party.imust.edu.cn` | ç½‘ç»œä¸­å¿ƒ | 1-2å·¥ä½œæ—¥ | æä¾›æŠ€æœ¯æ–¹æ¡ˆ |
| CASè®¤è¯æ¥å£æƒé™ | ç½‘ç»œä¸­å¿ƒ/ä¿¡æ¯åŒ–åŠ | 2-3å·¥ä½œæ—¥ | éœ€è¦ç³»ç»Ÿå¯¹æ¥ |
| ç½‘ç»œç™½åå• | ç½‘ç»œä¸­å¿ƒ | 1å·¥ä½œæ—¥ | äº‘æœåŠ¡å™¨IP |
| SSLè¯ä¹¦æ”¯æŒ | ç½‘ç»œä¸­å¿ƒ | å¯é€‰ | å¯ç”¨Let's Encrypt |

#### æŠ€æœ¯èµ„æºé‡‡è´­
| èµ„æº | æ¨èä¾›åº”å•† | é…ç½®å»ºè®® | é¢„ä¼°è´¹ç”¨ |
|-----|-----------|---------|---------|
| äº‘æœåŠ¡å™¨ | é˜¿é‡Œäº‘/è…¾è®¯äº‘ | 2æ ¸4G, 50GB SSD | Â¥200-300/æœˆ |
| åŸŸåè§£æ | é˜¿é‡Œäº‘DNS | DNSSECæ”¯æŒ | Â¥100-200/å¹´ |
| CDNåŠ é€Ÿ | é˜¿é‡Œäº‘CDN | é™æ€èµ„æºåŠ é€Ÿ | Â¥50-100/æœˆ |

### 1.2 ç”³è¯·æ–‡æ¡£æ¨¡æ¿

#### å­åŸŸåç”³è¯·é‚®ä»¶æ¨¡æ¿
```
ä¸»é¢˜: å…³äºç”³è¯·å…šç»„ç»‡ç®¡ç†ç³»ç»Ÿå­åŸŸåçš„å‡½

å°Šæ•¬çš„é¢†å¯¼:

ä¸ºäº†æ¨è¿›æˆ‘æ ¡å…šç»„ç»‡ç”Ÿæ´»ç®¡ç†çš„æ•°å­—åŒ–å»ºè®¾ï¼Œæå‡å…šå»ºå·¥ä½œä¿¡æ¯åŒ–æ°´å¹³ï¼Œç°ç”³è¯·å¼€é€šå…šç»„ç»‡ç”Ÿæ´»ä¼šè®®ç®¡ç†ç³»ç»Ÿå­åŸŸåã€‚

ã€é¡¹ç›®èƒŒæ™¯ã€‘
- é¡¹ç›®åç§°: å†…è’™å¤ç§‘æŠ€å¤§å­¦å…šç»„ç»‡ç”Ÿæ´»ä¼šè®®ç®¡ç†ç³»ç»Ÿ
- ä¸»è¦åŠŸèƒ½: ä¼šè®®ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ã€ç»Ÿè®¡åˆ†æã€æƒé™æ§åˆ¶
- æŠ€æœ¯æ–¹æ¡ˆ: åŸºäºç°ä»£WebæŠ€æœ¯ï¼Œæ”¯æŒPCç«¯å’Œç§»åŠ¨ç«¯
- éƒ¨ç½²æ–¹æ¡ˆ: äº‘æœåŠ¡å™¨éƒ¨ç½² + å­¦æ ¡å­åŸŸå

ã€æŠ€æœ¯æ–¹æ¡ˆã€‘
1. åŸŸåè§„åˆ’: party.imust.edu.cn
2. æœåŠ¡å™¨: é˜¿é‡Œäº‘/è…¾è®¯äº‘äº‘æœåŠ¡å™¨ (2æ ¸4Gé…ç½®)
3. å®‰å…¨æªæ–½: HTTPSåŠ å¯†ã€è®¿é—®æ§åˆ¶ã€æ•°æ®å¤‡ä»½
4. æ€§èƒ½ä¿è¯: æ”¯æŒ500+å¹¶å‘ç”¨æˆ·ï¼Œ99.9%å¯ç”¨æ€§

ã€å®‰å…¨åˆè§„ã€‘
- ç³»ç»Ÿç¬¦åˆå›½å®¶ç½‘ç»œå®‰å…¨ç›¸å…³è¦æ±‚
- æ•°æ®ä¼ è¾“é‡‡ç”¨HTTPSåŠ å¯†å­˜å‚¨
- å…·å¤‡å®Œæ•´çš„ç”¨æˆ·æƒé™ç®¡ç†
- æ”¯æŒæ“ä½œæ—¥å¿—å®¡è®¡

ã€ç»´æŠ¤ä¿éšœã€‘
- æä¾›7x24å°æ—¶æŠ€æœ¯ç›‘æ§
- å®šæœŸæ•°æ®å¤‡ä»½å’Œç³»ç»Ÿæ›´æ–°
- é…å¤‡ä¸“ä¸šæŠ€æœ¯ç»´æŠ¤å›¢é˜Ÿ

æ³è¯·æ‰¹å‡†æ­¤ç”³è¯·ï¼Œä»¥ä¾¿å°½å¿«æ¨è¿›ç³»ç»Ÿå»ºè®¾ã€‚

ç”³è¯·äºº: [å§“å]
è”ç³»æ–¹å¼: [ç”µè¯]
æ—¥æœŸ: 2025å¹´12æœˆ1æ—¥
```

#### CASå¯¹æ¥ç”³è¯·é‚®ä»¶æ¨¡æ¿
```
ä¸»é¢˜: å…³äºå¼€é€šCASç»Ÿä¸€è®¤è¯æ¥å£çš„ç”³è¯·

ç½‘ç»œä¸­å¿ƒé¢†å¯¼æ‚¨å¥½:

ä¸ºäº†å®ç°ç”¨æˆ·ç»Ÿä¸€èº«ä»½è®¤è¯ï¼Œç°ç”³è¯·å¼€é€šCASç³»ç»Ÿæ¥å£æƒé™ã€‚

ã€å¯¹æ¥éœ€æ±‚ã€‘
- ç³»ç»Ÿåç§°: å…šç»„ç»‡ç”Ÿæ´»ä¼šè®®ç®¡ç†ç³»ç»Ÿ  
- æœåŠ¡åœ°å€: https://party.imust.edu.cn
- è®¤è¯åè®®: CAS 2.0 / OAuth 2.0
- ç”¨æˆ·ä¿¡æ¯: å­¦å·/å·¥å·ã€å§“åã€éƒ¨é—¨ã€è§’è‰²

ã€æŠ€æœ¯å¯¹æ¥ã€‘
1. CASç™»å½•å›è°ƒé…ç½®
2. ç”¨æˆ·ä¿¡æ¯è·å–æ¥å£
3. è§’è‰²æƒé™æ˜ å°„é…ç½®
4. å•ç‚¹ç™»å‡ºå¤„ç†

ã€å®‰å…¨è¦æ±‚ã€‘
- åŠ å¯†ä¼ è¾“ç”¨æˆ·ä¿¡æ¯
- è®¿é—®é¢‘ç‡é™åˆ¶æ§åˆ¶
- ç”¨æˆ·æ•°æ®éšç§ä¿æŠ¤

çƒ¦è¯·æ‰¹å‡†å¼€é€šç›¸å…³æ¥å£æƒé™ã€‚

è”ç³»äºº: [å§“å]
ç”µè¯: [ç”µè¯]
```

### 1.3 èµ„é‡‘é¢„ç®—ç”³è¯·

#### é¡¹ç›®æˆæœ¬æ˜ç»†
```
ç¡¬ä»¶æˆæœ¬:
- äº‘æœåŠ¡å™¨ç§Ÿèµè´¹: Â¥200-300/æœˆ
- åŸŸåå’ŒSSLè¯ä¹¦: Â¥150/å¹´
- CDNåŠ é€ŸæœåŠ¡: Â¥50-100/æœˆ
- ç›‘æ§ç³»ç»Ÿ: Â¥100/æœˆ
å°è®¡: Â¥480-650/æœˆ

è½¯ä»¶æˆæœ¬:
- éƒ¨ç½²å·¥å…·: Â¥0 (å¼€æº)
- ç›‘æ§è½¯ä»¶: Â¥0 (å¼€æº)
- å®‰å…¨å·¥å…·: Â¥50/æœˆ
å°è®¡: Â¥50/æœˆ

äººåŠ›æˆæœ¬:
- éƒ¨ç½²å®æ–½: 3äººæ—¥
- æµ‹è¯•éªŒæ”¶: 2äººæ—¥  
- åŸ¹è®­ç”¨æˆ·: 3äººæ—¥
- æ–‡æ¡£ç¼–å†™: 1äººæ—¥

æ€»è®¡: Â¥530-700/æœˆ, çº¦ Â¥6360-8400/å¹´
```

---

## ğŸ“‹ ç¬¬äºŒé˜¶æ®µ: æŠ€æœ¯å®æ–½ (1-2å¤©)

### 2.1 æœåŠ¡å™¨ç¯å¢ƒæ­å»º

#### é˜¿é‡Œäº‘æœåŠ¡å™¨é…ç½®æ­¥éª¤

**1. åˆ›å»ºECSå®ä¾‹**
```bash
# åŸºç¡€é…ç½®
- å®ä¾‹è§„æ ¼: ecs.t5-lc1m2.small (1æ ¸2G) æˆ–æ›´é«˜
- æ“ä½œç³»ç»Ÿ: Ubuntu 20.04 LTS
- å®‰å…¨ç»„: å¼€æ”¾80, 443, 22ç«¯å£
- ç½‘ç»œ: ä¸“æœ‰ç½‘ç»œ + å…¬ç½‘IP
```

**2. åˆå§‹åŒ–ç³»ç»Ÿ**
```bash
# è¿æ¥æœåŠ¡å™¨
ssh root@your-server-ip

# æ›´æ–°ç³»ç»Ÿ
apt update && apt upgrade -y

# å®‰è£…å¿…è¦è½¯ä»¶
apt install -y nginx curl unzip git ufw fail2ban

# é…ç½®é˜²ç«å¢™
ufw default deny incoming
ufw default allow outgoing  
ufw allow ssh
ufw allow http
ufw allow https
ufw --force enable

# é…ç½®fail2ban
systemctl enable fail2ban
systemctl start fail2ban
```

**3. é…ç½®Nginx**
```bash
# åˆ›å»ºç½‘ç«™ç›®å½•
mkdir -p /var/www/party-system
chown -R www-data:www-data /var/www/party-system

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > /etc/nginx/sites-available/party.imust.edu.cn << 'EOF'
server {
    listen 80;
    server_name party.imust.edu.cn;
    root /var/www/party-system;
    index index.html;

    # å®‰å…¨å¤´é…ç½®
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # ä¸»è¦ä»£ç†åˆ°Supabase
    location /api/ {
        proxy_pass https://lfmpvxczahvcselayyho.supabase.co/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }

    # Reactè·¯ç”±æ”¯æŒ
    location / {
        try_files $uri $uri/ /index.html;
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }

    # é™åˆ¶è®¿é—®é¢‘ç‡
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
    limit_req zone=api burst=20;
}
EOF

# å¯ç”¨ç½‘ç«™
ln -sf /etc/nginx/sites-available/party.imust.edu.cn /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®
nginx -t

# é‡å¯Nginx
systemctl reload nginx
```

### 2.2 SSLè¯ä¹¦é…ç½®

#### ä½¿ç”¨Let's Encryptç”³è¯·SSLè¯ä¹¦
```bash
# å®‰è£…Certbot
apt install -y certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦
certbot --nginx -d party.imust.edu.cn

# é…ç½®è‡ªåŠ¨ç»­æœŸ
echo "0 12 * * * /usr/bin/certbot renew --quiet" | crontab -

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run
```

#### è¯ä¹¦éªŒè¯è„šæœ¬
```bash
cat > /root/ssl-check.sh << 'EOF'
#!/bin/bash
# SSLè¯ä¹¦æ£€æŸ¥è„šæœ¬

CERT_FILE="/etc/letsencrypt/live/party.imust.edu.cn/fullchain.pem"

if [ -f "$CERT_FILE" ]; then
    EXPIRY_DATE=$(openssl x509 -enddate -noout -in "$CERT_FILE" | cut -d= -f2)
    EXPIRY_TIMESTAMP=$(date -d "$EXPIRY_DATE" +%s)
    CURRENT_TIMESTAMP=$(date +%s)
    
    DAYS_LEFT=$(( ($EXPIRY_TIMESTAMP - $CURRENT_TIMESTAMP) / 86400 ))
    
    if [ $DAYS_LEFT -lt 30 ]; then
        echo "WARNING: SSLè¯ä¹¦å°†åœ¨ $DAYS_LEFT å¤©åè¿‡æœŸ"
        echo "å°†è§¦å‘è‡ªåŠ¨ç»­æœŸ..."
        certbot renew --quiet
    else
        echo "SSLè¯ä¹¦æœ‰æ•ˆï¼Œå‰©ä½™å¤©æ•°: $DAYS_LEFT"
    fi
else
    echo "ERROR: SSLè¯ä¹¦æ–‡ä»¶ä¸å­˜åœ¨"
fi
EOF

chmod +x /root/ssl-check.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡
echo "0 2 * * * /root/ssl-check.sh" | crontab -
```

### 2.3 ç³»ç»Ÿæ–‡ä»¶éƒ¨ç½²

#### 1. ä¸Šä¼ æ„å»ºæ–‡ä»¶
```bash
# åœ¨æœ¬åœ°æ‰§è¡Œ (æ–‡ä»¶è·¯å¾„éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´)
scp -r dist/* user@server:/tmp/party-system/

# åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ
cd /var/www/party-system
cp /tmp/party-system/* .
rm -rf /tmp/party-system

# è®¾ç½®æƒé™
chown -R www-data:www-data /var/www/party-system
chmod -R 755 /var/www/party-system
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡
```bash
# åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
cat > /var/www/party-system/.env.production << 'EOF'
VITE_SUPABASE_URL=https://lfmpvxczahvcselayyho.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxmbXB2eGN6YWh2Y3NlbGF5eWhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0MDA4MDEsImV4cCI6MjA3OTk3NjgwMX0.ZCafc0DNXOQueWQS4qsCUsecqAVUauH6kVK-w22QIPo

# å­¦æ ¡ç‰¹å®šé…ç½®
VITE_SCHOOL_NAME=å†…è’™å¤ç§‘æŠ€å¤§å­¦
VITE_SYSTEM_NAME=å…šç»„ç»‡ç”Ÿæ´»ä¼šè®®ç®¡ç†ç³»ç»Ÿ
VITE_DOMAIN=party.imust.edu.cn
VITE_CAS_URL=https://cas.imust.edu.cn
EOF

chmod 600 /var/www/party-system/.env.production
```

#### 3. é…ç½®Nginxç¼“å­˜å’Œæ—¥å¿—
```nginx
# åœ¨nginxé…ç½®ä¸­æ·»åŠ 
server {
    # ... å…¶ä»–é…ç½® ...
    
    # æ—¥å¿—é…ç½®
    access_log /var/log/nginx/party.imust.edu.cn.access.log;
    error_log /var/log/nginx/party.imust.edu.cn.error.log;
    
    # ç¼“å­˜é…ç½®
    location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, no-transform";
        access_log off;
    }
    
    location ~* \.(html|json|xml)$ {
        expires 1h;
        add_header Cache-Control "public";
    }
}
```

### 2.4 ç›‘æ§ç³»ç»Ÿé…ç½®

#### 1. ç³»ç»Ÿç›‘æ§è„šæœ¬
```bash
cat > /var/www/monitor.sh << 'EOF'
#!/bin/bash
# ç³»ç»Ÿç›‘æ§è„šæœ¬

LOG_FILE="/var/log/system-monitor.log"
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

# æ£€æŸ¥NginxçŠ¶æ€
if ! systemctl is-active --quiet nginx; then
    echo "$TIMESTAMP - ERROR: Nginx is not running" >> $LOG_FILE
    systemctl restart nginx
fi

# æ£€æŸ¥ç£ç›˜ç©ºé—´
DISK_USAGE=$(df /var/www | awk 'NR==2 {print $5}' | sed 's/%//')
if [ $DISK_USAGE -gt 80 ]; then
    echo "$TIMESTAMP - WARNING: Disk usage is ${DISK_USAGE}%" >> $LOG_FILE
fi

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
MEM_USAGE=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}')
if [ $MEM_USAGE -gt 85 ]; then
    echo "$TIMESTAMP - WARNING: Memory usage is ${MEM_USAGE}%" >> $LOG_FILE
fi

# æ£€æŸ¥ç½‘ç«™å“åº”
HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" http://party.imust.edu.cn/health)
if [ "$HTTP_CODE" != "200" ]; then
    echo "$TIMESTAMP - ERROR: Website not responding, HTTP code: $HTTP_CODE" >> $LOG_FILE
fi

# æ£€æŸ¥SSLè¯ä¹¦
/root/ssl-check.sh >> $LOG_FILE

echo "$TIMESTAMP - System check completed" >> $LOG_FILE
EOF

chmod +x /var/www/monitor.sh
```

#### 2. é…ç½®å®šæ—¶ç›‘æ§
```bash
# æ·»åŠ åˆ°crontab (æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡)
(crontab -l 2>/dev/null; echo "*/5 * * * * /var/www/monitor.sh") | crontab -
```

#### 3. æ—¥å¿—è½®è½¬é…ç½®
```bash
cat > /etc/logrotate.d/party-system << 'EOF'
/var/log/nginx/party.imust.edu.cn.*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0640 www-data adm
}

/var/log/system-monitor.log {
    weekly
    missingok
    rotate 12
    compress
    delaycompress
    notifempty
    create 0640 root adm
}
EOF
```

---

## ğŸ“‹ ç¬¬ä¸‰é˜¶æ®µ: CASé›†æˆ (0.5-1å¤©)

### 3.1 CASè®¤è¯é…ç½®

#### å‰ç«¯CASé›†æˆä»£ç 
```javascript
// src/lib/cas.ts - CASè®¤è¯å·¥å…·ç±»
import { supabase } from './supabase';

class CASAuth {
    private casUrl: string;
    private serviceUrl: string;

    constructor() {
        this.casUrl = import.meta.env.VITE_CAS_URL || 'https://cas.imust.edu.cn';
        this.serviceUrl = window.location.origin;
    }

    // è·³è½¬åˆ°CASç™»å½•é¡µé¢
    redirectToCAS() {
        const service = encodeURIComponent(this.serviceUrl);
        const redirect = encodeURIComponent(`${this.serviceUrl}/callback`);
        window.location.href = `${this.casUrl}/login?service=${service}&redirect_uri=${redirect}`;
    }

    // å¤„ç†CASå›è°ƒ
    async handleCallback(ticket: string): Promise<boolean> {
        try {
            // éªŒè¯ç¥¨æ®
            const response = await fetch(`${this.casUrl}/serviceValidate?service=${encodeURIComponent(this.serviceUrl)}&ticket=${ticket}`);
            const data = await response.text();
            
            // è§£æCASå“åº” (ç®€åŒ–å¤„ç†)
            const userInfo = this.parseCASResponse(data);
            if (userInfo) {
                // åˆ›å»ºæˆ–æ›´æ–°ç”¨æˆ·ä¿¡æ¯
                await this.syncUser(userInfo);
                return true;
            }
            return false;
        } catch (error) {
            console.error('CASè®¤è¯å¤±è´¥:', error);
            return false;
        }
    }

    // è§£æCASå“åº”
    private parseCASResponse(xml: string) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(xml, 'text/xml');
        
        const authenticationSuccess = doc.querySelector('cas\\:authenticationSuccess, authenticationSuccess');
        if (authenticationSuccess) {
            const user = authenticationSuccess.querySelector('cas\\:user, user')?.textContent;
            const attributes = authenticationSuccess.querySelector('cas\\:attributes, attributes');
            
            if (user) {
                return {
                    username: user,
                    studentId: attributes?.querySelector('studentId')?.textContent,
                    fullName: attributes?.querySelector('fullName')?.textContent,
                    department: attributes?.querySelector('department')?.textContent,
                    role: attributes?.querySelector('role')?.textContent
                };
            }
        }
        return null;
    }

    // åŒæ­¥ç”¨æˆ·ä¿¡æ¯åˆ°ç³»ç»Ÿ
    private async syncUser(userInfo: any) {
        const { data, error } = await supabase
            .from('user_profiles')
            .upsert({
                id: userInfo.studentId,
                full_name: userInfo.fullName,
                phone: '',
                role: this.mapRole(userInfo.role),
                org_id: userInfo.department,
                updated_at: new Date().toISOString()
            });

        if (error) {
            console.error('ç”¨æˆ·åŒæ­¥å¤±è´¥:', error);
        }

        // è®¾ç½®å½“å‰ç”¨æˆ·ä¼šè¯
        await supabase.auth.signInWithIdToken({
            token: userInfo.studentId,
            provider: 'cas'
        });
    }

    // è§’è‰²æ˜ å°„
    private mapRole(casRole: string): string {
        const roleMap: Record<string, string> = {
            'admin': 'super_admin',
            'teacher': 'admin', 
            'student': 'user'
        };
        return roleMap[casRole] || 'user';
    }

    // ç™»å‡º
    async logout() {
        await supabase.auth.signOut();
        window.location.href = `${this.casUrl}/logout?service=${encodeURIComponent(this.serviceUrl)}`;
    }
}

export const casAuth = new CASAuth();
```

#### ç™»å½•é¡µé¢é›†æˆ
```javascript
// src/pages/LoginPage.tsx - ä¿®æ”¹ç™»å½•é€»è¾‘
import { casAuth } from '../lib/cas';

// åŸæœ‰ç™»å½•é€»è¾‘ä¿æŒä¸å˜ï¼Œæ·»åŠ CASç™»å½•
const handleCASLogin = async () => {
    casAuth.redirectToCAS();
};

// åœ¨ç»„ä»¶ä¸­æ·»åŠ CASç™»å½•æŒ‰é’®
return (
    <div className="login-container">
        {/* åŸæœ‰ç™»å½•è¡¨å• */}
        <div className="mt-6">
            <div className="relative">
                <div className="absolute inset-0 flex items-center">
                    <div className="w-full border-t border-gray-300" />
                </div>
                <div className="relative flex justify-center text-sm">
                    <span className="px-2 bg-white text-gray-500">æˆ–è€…</span>
                </div>
            </div>
            
            <div className="mt-6">
                <button
                    onClick={handleCASLogin}
                    className="w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
                >
                    <span className="sr-only">å†…è’™å¤ç§‘æŠ€å¤§å­¦ç»Ÿä¸€ç™»å½•</span>
                    å†…è’™å¤ç§‘æŠ€å¤§å­¦ç»Ÿä¸€ç™»å½•
                </button>
            </div>
        </div>
    </div>
);
```

### 3.2 å›è°ƒå¤„ç†è·¯ç”±
```javascript
// src/App.tsx - æ·»åŠ CASå›è°ƒå¤„ç†
import { useEffect } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import { casAuth } from './lib/cas';

function App() {
    const navigate = useNavigate();
    const [searchParams] = useSearchParams();
    
    useEffect(() => {
        const ticket = searchParams.get('ticket');
        const action = searchParams.get('action');
        
        if (action === 'cas-callback' && ticket) {
            handleCASCallback(ticket);
        }
    }, [searchParams]);

    const handleCASCallback = async (ticket: string) => {
        const success = await casAuth.handleCallback(ticket);
        if (success) {
            navigate('/dashboard');
        } else {
            navigate('/login');
        }
    };

    // å…¶ä»–ä»£ç ...
}
```

---

## ğŸ“‹ ç¬¬å››é˜¶æ®µ: æµ‹è¯•éªŒè¯ (0.5-1å¤©)

### 4.1 åŠŸèƒ½æµ‹è¯•æ¸…å•

#### åŸºç¡€åŠŸèƒ½æµ‹è¯•
| åŠŸèƒ½æ¨¡å— | æµ‹è¯•é¡¹ç›® | æµ‹è¯•æ–¹æ³• | é¢„æœŸç»“æœ |
|---------|---------|---------|---------|
| **é¡µé¢è®¿é—®** | ä¸»é¡µåŠ è½½ | è®¿é—® https://party.imust.edu.cn | é¡µé¢æ­£å¸¸æ˜¾ç¤º |
| **CASè®¤è¯** | å­¦æ ¡ç™»å½• | ç‚¹å‡»å­¦æ ¡ç»Ÿä¸€ç™»å½•æŒ‰é’® | è·³è½¬åˆ°CASç™»å½•é¡µé¢ |
| **ç”¨æˆ·ç®¡ç†** | ç”¨æˆ·åˆ—è¡¨ | ç®¡ç†å‘˜æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ | æ˜¾ç¤ºåˆ†é¡µç”¨æˆ·åˆ—è¡¨ |
| **ä¼šè®®ç®¡ç†** | åˆ›å»ºä¼šè®® | åˆ›å»ºæ–°ä¼šè®®è®°å½• | ä¼šè®®æˆåŠŸåˆ›å»º |
| **æ–‡ä»¶ä¸Šä¼ ** | æ–‡ä»¶ç®¡ç† | ä¸Šä¼ ä¼šè®®ç›¸å…³æ–‡ä»¶ | æ–‡ä»¶æˆåŠŸä¸Šä¼  |
| **æƒé™æ§åˆ¶** | è§’è‰²éªŒè¯ | ä¸åŒè§’è‰²è®¿é—®åŠŸèƒ½ | æƒé™æ­£ç¡®æ§åˆ¶ |
| **ç§»åŠ¨ç«¯** | å“åº”å¼ | æ‰‹æœºè®¿é—®ç³»ç»Ÿ | ç•Œé¢è‡ªé€‚åº” |

#### æ€§èƒ½æµ‹è¯•
```bash
# 1. é¡µé¢åŠ è½½é€Ÿåº¦æµ‹è¯•
curl -w "@curl-format.txt" -o /dev/null -s "https://party.imust.edu.cn"

# curl-format.txtå†…å®¹:
echo 'time_namelookup: %{time_namelookup}\ntime_connect: %{time_connect}\ntime_appconnect: %{time_appconnect}\ntime_pretransfer: %{time_pretransfer}\ntime_redirect: %{time_redirect}\ntime_starttransfer: %{time_starttransfer}\ntime_total: %{time_total}\n' > curl-format.txt

# 2. å¹¶å‘æµ‹è¯•
apt install -y apache2-utils
ab -n 1000 -c 10 https://party.imust.edu.cn/

# 3. å‹åŠ›æµ‹è¯• (å»ºè®®åœ¨éç”Ÿäº§ç¯å¢ƒè¿›è¡Œ)
ab -n 10000 -c 50 https://party.imust.edu.cn/
```

### 4.2 å®‰å…¨æµ‹è¯•

#### SSL/TLSå®‰å…¨æ£€æŸ¥
```bash
# 1. SSLè¯ä¹¦æ£€æŸ¥
openssl s_client -connect party.imust.edu.cn:443 -servername party.imust.edu.cn

# 2. SSLå®‰å…¨æ€§æµ‹è¯•
# è®¿é—® https://www.ssllabs.com/ssltest/ è¿›è¡Œåœ¨çº¿æµ‹è¯•

# 3. HTTPå®‰å…¨å¤´æ£€æŸ¥
curl -I https://party.imust.edu.cn
```

#### æ¼æ´æ‰«æ
```bash
# 1. åŸºæœ¬æ¼æ´æ‰«æ (éœ€è¦å®‰è£…)
apt install -y nmap
nmap -sV -sC party.imust.edu.cn

# 2. HTTPå¤´éƒ¨æ£€æŸ¥
curl -I https://party.imust.edu.cn
```

### 4.3 å…¼å®¹æ€§æµ‹è¯•

#### æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•
| æµè§ˆå™¨ | ç‰ˆæœ¬ | æµ‹è¯•ç»“æœ | å¤‡æ³¨ |
|-------|------|---------|------|
| Chrome | 90+ | âœ… | ä¸»è¦æµ‹è¯•æµè§ˆå™¨ |
| Firefox | 88+ | âœ… | éœ€è¦æµ‹è¯•CSSå…¼å®¹æ€§ |
| Safari | 14+ | âœ… | ç§»åŠ¨ç«¯é€‚é… |
| Edge | 90+ | âœ… | IE11åŸºç¡€åŠŸèƒ½ |
| å¾®ä¿¡å†…ç½® | æœ€æ–° | âœ… | ç§»åŠ¨ç«¯å¸¸ç”¨ |

#### ç§»åŠ¨ç«¯æµ‹è¯•
```javascript
// ç§»åŠ¨ç«¯é€‚é…æµ‹è¯•æ¸…å•
- [ ] iPhone (Safari) æ­£å¸¸è®¿é—®
- [ ] Android (Chrome) æ­£å¸¸è®¿é—®  
- [ ] å¹³æ¿è®¾å¤‡å“åº”å¼é€‚é…
- [ ] è§¦æ‘¸æ“ä½œå“åº”è‰¯å¥½
- [ ] ç½‘ç»œæ…¢é€Ÿç¯å¢ƒå¯ç”¨
```

---

## ğŸ“‹ ç¬¬äº”é˜¶æ®µ: ä¸Šçº¿è¿ç»´ (æŒç»­)

### 5.1 ç³»ç»Ÿä¸Šçº¿æ£€æŸ¥æ¸…å•

#### ä¸Šçº¿å‰æ£€æŸ¥
- [ ] æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- [ ] å®‰å…¨æµ‹è¯•é€šè¿‡
- [ ] æ•°æ®å¤‡ä»½å®Œæˆ
- [ ] ç›‘æ§ç³»ç»Ÿè¿è¡Œæ­£å¸¸
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸
- [ ] SSLè¯ä¹¦æœ‰æ•ˆ
- [ ] åŸŸåè§£ææ­£ç¡®

#### ä¸Šçº¿åç›‘æ§
```bash
# 1. å®æ—¶ç›‘æ§ç³»ç»Ÿ
tail -f /var/log/nginx/party.imust.edu.cn.access.log

# 2. å®šæœŸå¥åº·æ£€æŸ¥
crontab -l | grep monitor

# 3. æ€§èƒ½ç›‘æ§
htop
iotop
```

### 5.2 æ•…éšœåº”æ€¥é¢„æ¡ˆ

#### å¸¸è§æ•…éšœå¤„ç†
| æ•…éšœç±»å‹ | æ’æŸ¥æ–¹æ³• | è§£å†³æ­¥éª¤ |
|---------|---------|---------|
| **ç½‘ç«™æ— æ³•è®¿é—®** | æ£€æŸ¥nginxçŠ¶æ€å’Œç«¯å£ | é‡å¯nginx, æ£€æŸ¥é˜²ç«å¢™ |
| **ç™»å½•å¤±è´¥** | æ£€æŸ¥CASé…ç½® | éªŒè¯CASåœ°å€å’Œå›è°ƒURL |
| **æ•°æ®åº“è¿æ¥å¤±è´¥** | æ£€æŸ¥SupabaseçŠ¶æ€ | éªŒè¯APIå¯†é’¥å’Œç½‘ç»œ |
| **æ–‡ä»¶ä¸Šä¼ å¤±è´¥** | æ£€æŸ¥å­˜å‚¨æƒé™ | éªŒè¯å­˜å‚¨æ¡¶é…ç½® |
| **SSLè¯ä¹¦è¿‡æœŸ** | æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ | æ‰‹åŠ¨ç»­æœŸæˆ–é‡å¯æœåŠ¡ |

#### åº”æ€¥æ¢å¤è„šæœ¬
```bash
cat > /root/emergency-recovery.sh << 'EOF'
#!/bin/bash
# ç´§æ€¥æ¢å¤è„šæœ¬

echo "å¼€å§‹ç´§æ€¥æ¢å¤..."

# 1. é‡å¯æ ¸å¿ƒæœåŠ¡
systemctl restart nginx
systemctl restart fail2ban

# 2. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# 3. æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h

# 4. æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
uptime

# 5. é‡æ–°åŠ è½½nginxé…ç½®
nginx -t && systemctl reload nginx

# 6. æ£€æŸ¥SSLè¯ä¹¦
/root/ssl-check.sh

# 7. æµ‹è¯•ç½‘ç«™å“åº”
curl -I https://party.imust.edu.cn

echo "ç´§æ€¥æ¢å¤å®Œæˆ"
EOF

chmod +x /root/emergency-recovery.sh
```

### 5.3 ç”¨æˆ·åŸ¹è®­æ–¹æ¡ˆ

#### åŸ¹è®­å¯¹è±¡åˆ†çº§
1. **ç³»ç»Ÿç®¡ç†å‘˜** (2-3äºº)
   - ç³»ç»Ÿé…ç½®å’Œç»´æŠ¤
   - ç”¨æˆ·æƒé™ç®¡ç†
   - æ•°æ®å¤‡ä»½æ¢å¤
   - æ•…éšœæ’æŸ¥å¤„ç†

2. **å…šç»„ç»‡è´Ÿè´£äºº** (10-15äºº)  
   - ä¼šè®®ç®¡ç†æ“ä½œ
   - ç”¨æˆ·ç®¡ç†åŠŸèƒ½
   - æ•°æ®ç»Ÿè®¡åˆ†æ
   - æƒé™åˆ†é…ç®¡ç†

3. **æ™®é€šå…šå‘˜ç”¨æˆ·** (100+äºº)
   - åŸºæœ¬ç™»å½•ä½¿ç”¨
   - æŸ¥çœ‹ä¼šè®®ä¿¡æ¯
   - å‚ä¸ä¼šè®®æ´»åŠ¨
   - æŸ¥çœ‹é€šçŸ¥æ¶ˆæ¯

#### åŸ¹è®­ææ–™å‡†å¤‡
- **ç”¨æˆ·æ“ä½œæ‰‹å†Œ** (PDFç‰ˆæœ¬)
- **è§†é¢‘æ•™ç¨‹** (åˆ†æ¨¡å—å½•åˆ¶)
- **å¸¸è§é—®é¢˜è§£ç­”** (FAQæ–‡æ¡£)
- **è”ç³»æ–¹å¼** (æŠ€æœ¯æ”¯æŒç¾¤)

### 5.4 æŒç»­ä¼˜åŒ–è®¡åˆ’

#### æœˆåº¦ç»´æŠ¤ä»»åŠ¡
- [ ] ç³»ç»Ÿæ€§èƒ½åˆ†æ
- [ ] å®‰å…¨æ›´æ–°æ£€æŸ¥
- [ ] æ•°æ®åº“ä¼˜åŒ–
- [ ] å¤‡ä»½éªŒè¯
- [ ] ç”¨æˆ·åé¦ˆæ”¶é›†

#### åŠŸèƒ½è¿­ä»£è®¡åˆ’
- [ ] æ ¹æ®ä½¿ç”¨åé¦ˆä¼˜åŒ–ç•Œé¢
- [ ] æ·»åŠ æ–°çš„ç»Ÿè®¡æŠ¥è¡¨
- [ ] é›†æˆæ›´å¤šå­¦æ ¡ç³»ç»Ÿ
- [ ] ç§»åŠ¨ç«¯APPå¼€å‘
- [ ] AIæ™ºèƒ½åŠ©æ‰‹åŠŸèƒ½

---

## ğŸ“ å®æ–½æ—¶é—´è¡¨

### è¯¦ç»†æ—¶é—´å®‰æ’

| æ—¥æœŸ | å·¥ä½œå†…å®¹ | è´Ÿè´£äºº | é¢„æœŸæˆæœ |
|-----|---------|-------|---------|
| **ç¬¬1å¤©** | èµ„æºç”³è¯·æäº¤ | é¡¹ç›®è´Ÿè´£äºº | å®Œæˆæ‰€æœ‰ç”³è¯·æ–‡æ¡£ |
| **ç¬¬2å¤©** | æŠ€æœ¯ç¯å¢ƒæ­å»º | æŠ€æœ¯å›¢é˜Ÿ | æœåŠ¡å™¨ç¯å¢ƒå°±ç»ª |
| **ç¬¬3å¤©** | ç³»ç»Ÿéƒ¨ç½²é…ç½® | æŠ€æœ¯å›¢é˜Ÿ | ç½‘ç«™å¯æ­£å¸¸è®¿é—® |
| **ç¬¬4å¤©** | CASé›†æˆæµ‹è¯• | æŠ€æœ¯å›¢é˜Ÿ | è®¤è¯ç³»ç»Ÿæ­£å¸¸å·¥ä½œ |
| **ç¬¬5å¤©** | å…¨é¢åŠŸèƒ½æµ‹è¯• | æµ‹è¯•å›¢é˜Ÿ | æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡ |
| **ç¬¬6å¤©** | ç”¨æˆ·åŸ¹è®­ | åŸ¹è®­å›¢é˜Ÿ | æ ¸å¿ƒç”¨æˆ·ç†Ÿç»ƒæ“ä½œ |
| **ç¬¬7å¤©** | æ­£å¼ä¸Šçº¿ | é¡¹ç›®ç»„ | ç³»ç»Ÿæ­£å¼æŠ•å…¥ä½¿ç”¨ |

### å…³é”®èŠ‚ç‚¹æ£€æŸ¥

#### é‡Œç¨‹ç¢‘1: æŠ€æœ¯ç¯å¢ƒå°±ç»ª
- âœ… äº‘æœåŠ¡å™¨é…ç½®å®Œæˆ
- âœ… åŸŸåè§£æé…ç½®æ­£ç¡®  
- âœ… SSLè¯ä¹¦ç”³è¯·æˆåŠŸ
- âœ… ç½‘ç«™å¯æ­£å¸¸è®¿é—®

#### é‡Œç¨‹ç¢‘2: åŠŸèƒ½é›†æˆå®Œæˆ
- âœ… CASè®¤è¯å¯¹æ¥æˆåŠŸ
- âœ… ç”¨æˆ·æƒé™æ˜ å°„æ­£ç¡®
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
- âœ… æ ¸å¿ƒåŠŸèƒ½å¯ä½¿ç”¨

#### é‡Œç¨‹ç¢‘3: ç³»ç»Ÿä¸Šçº¿è¿è¡Œ
- âœ… æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… ç”¨æˆ·åŸ¹è®­å®Œæˆ
- âœ… ç›‘æ§ç³»ç»Ÿè¿è¡Œ
- âœ… æ•…éšœé¢„æ¡ˆå°±ç»ª

---

## ğŸ¯ æˆåŠŸéªŒæ”¶æ ‡å‡†

### æŠ€æœ¯æŒ‡æ ‡
- **å¯ç”¨æ€§**: 99.9% (å¹´åœæœºæ—¶é—´<8.76å°æ—¶)
- **å“åº”æ—¶é—´**: é¦–é¡µ<2ç§’ï¼ŒåŠŸèƒ½é¡µé¢<3ç§’
- **å¹¶å‘æ”¯æŒ**: æ”¯æŒ500+ç”¨æˆ·åŒæ—¶åœ¨çº¿
- **æ•°æ®å®‰å…¨**: HTTPSåŠ å¯†ï¼Œæƒé™æ§åˆ¶æœ‰æ•ˆ

### åŠŸèƒ½æŒ‡æ ‡  
- **ç”¨æˆ·ç®¡ç†**: å®Œæ•´çš„ç”¨æˆ·CRUDæ“ä½œ
- **ä¼šè®®ç®¡ç†**: ä¼šè®®å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **æ–‡ä»¶ç®¡ç†**: å®‰å…¨çš„æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
- **ç»Ÿè®¡åˆ†æ**: å‡†ç¡®çš„æ•°æ®ç»Ÿè®¡æŠ¥è¡¨
- **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- **å­¦ä¹ æˆæœ¬**: æ™®é€šç”¨æˆ·30åˆ†é’ŸæŒæ¡
- **æ“ä½œæ•ˆç‡**: æ¯”ä¼ ç»Ÿæ–¹å¼æå‡50%
- **æ»¡æ„åº¦**: ç”¨æˆ·æ»¡æ„åº¦>90%
- **ç§»åŠ¨æ”¯æŒ**: ç§»åŠ¨ç«¯åŠŸèƒ½å®Œæ•´å¯ç”¨

---

**æ³¨æ„äº‹é¡¹**:
1. éƒ¨ç½²è¿‡ç¨‹ä¸­å¦‚æœ‰æŠ€æœ¯é—®é¢˜ï¼Œè¯·åŠæ—¶è”ç³»æŠ€æœ¯æ”¯æŒ
2. å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒå®Œæ•´éªŒè¯åå†åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ
3. ä¸Šçº¿åéœ€è¦å¯†åˆ‡ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
4. åšå¥½æ•°æ®å¤‡ä»½ï¼Œé˜²æ­¢æ„å¤–æƒ…å†µå¯¼è‡´æ•°æ®ä¸¢å¤±

**æŠ€æœ¯æ”¯æŒ**: æœ¬éƒ¨ç½²æŒ‡å—ç”±æŠ€æœ¯å›¢é˜Ÿæä¾›å…¨ç¨‹æ”¯æŒï¼Œç¡®ä¿éƒ¨ç½²è¿‡ç¨‹é¡ºåˆ©è¿›è¡Œã€‚